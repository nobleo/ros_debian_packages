name: builder

on:
  workflow_dispatch:
  push:

jobs:
  build_testing:
    runs-on: ubuntu-22.04
    steps:
      # - uses: jspricke/ros-deb-builder-action@main until: https://github.com/jspricke/ros-deb-builder-action/issues/38
      - uses: christianrauch/ros-deb-builder-action@5befeabf68aad37cd1e3c594bbb13fe3f4b83de3
        with:
          ROS_DISTRO: iron
          DEB_DISTRO: jammy
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPOS_FILE: iron.repos
          GIT_LFS: true
          # List generated by:
          # git clone https://github.com/nobleo/autoware.universe.git
          # echo "$(colcon list --names-only) $(colcon list --names-only --packages-up-to ground_segmentation)" | sort | uniq -u
          SKIP_PACKAGES: >-
            accel_brake_map_calibrator
            ad_api_adaptors
            ad_api_visualizers
            ar_tag_based_localizer
            automatic_pose_initializer
            autonomous_emergency_braking
            autoware_ad_api_specs
            autoware_auto_common
            autoware_auto_msgs_adapter
            autoware_auto_perception_rviz_plugin
            autoware_overlay_msgs
            autoware_overlay_rviz_plugin
            autoware_testing
            bag_time_manager_rviz_plugin
            behavior_path_avoidance_by_lane_change_module
            behavior_path_avoidance_module
            behavior_path_dynamic_avoidance_module
            behavior_path_external_request_lane_change_module
            behavior_path_goal_planner_module
            behavior_path_lane_change_module
            behavior_path_planner
            behavior_path_planner_common
            behavior_path_sampling_planner_module
            behavior_path_side_shift_module
            behavior_path_start_planner_module
            behavior_velocity_blind_spot_module
            behavior_velocity_crosswalk_module
            behavior_velocity_detection_area_module
            behavior_velocity_dynamic_obstacle_stop_module
            behavior_velocity_intersection_module
            behavior_velocity_no_drivable_lane_module
            behavior_velocity_no_stopping_area_module
            behavior_velocity_occlusion_spot_module
            behavior_velocity_out_of_lane_module
            behavior_velocity_planner
            behavior_velocity_planner_common
            behavior_velocity_run_out_module
            behavior_velocity_speed_bump_module
            behavior_velocity_stop_line_module
            behavior_velocity_template_module
            behavior_velocity_traffic_light_module
            behavior_velocity_virtual_traffic_light_module
            behavior_velocity_walkway_module
            bezier_sampler
            bluetooth_monitor
            bytetrack
            cluster_merger
            compare_map_segmentation
            component_interface_specs
            component_interface_tools
            component_interface_utils
            component_state_monitor
            control_performance_analysis
            control_validator
            costmap_generator
            crosswalk_traffic_light_estimator
            cuda_utils
            default_ad_api
            detected_object_feature_remover
            detected_object_validation
            detection_by_tracker
            diagnostic_converter
            diagnostic_graph_aggregator
            dummy_diag_publisher
            dummy_infrastructure
            dummy_perception_publisher
            duplicated_node_checker
            ekf_localizer
            elevation_map_loader
            emergency_handler
            euclidean_cluster
            external_cmd_converter
            external_cmd_selector
            external_velocity_limit_selector
            fake_test_node
            fault_injection
            freespace_planner
            freespace_planning_algorithms
            frenet_planner
            geo_pose_projector
            geography_utils
            global_parameter_loader
            glog_component
            gnss_poser
            goal_distance_calculator
            grid_map_utils
            gyro_odometer
            hazard_status_converter
            image_diagnostics
            image_projection_based_fusion
            image_transport_decompressor
            imu_corrector
            interpolation
            joy_controller
            kalman_filter
            kinematic_evaluator
            landmark_manager
            lane_departure_checker
            lanelet2_map_preprocessor
            lidar_apollo_instance_segmentation
            lidar_apollo_segmentation_tvm
            lidar_apollo_segmentation_tvm_nodes
            lidar_centerpoint
            lidar_centerpoint_tvm
            livox_tag_filter
            localization_error_monitor
            localization_evaluator
            localization_util
            map_based_prediction
            map_height_fitter
            map_loader
            map_projection_loader
            map_tf_generator
            mission_planner
            mission_planner_rviz_plugin
            motion_utils
            motion_velocity_smoother
            mpc_lateral_controller
            mrm_comfortable_stop_operator
            mrm_emergency_stop_operator
            mrm_handler
            multi_object_tracker
            ndt_scan_matcher
            object_merger
            object_range_splitter
            object_recognition_utils
            object_velocity_splitter
            objects_of_interest_marker_interface
            obstacle_avoidance_planner
            obstacle_collision_checker
            obstacle_cruise_planner
            obstacle_stop_planner
            obstacle_velocity_limiter
            occupancy_grid_map_outlier_filter
            operation_mode_transition_manager
            osqp_interface
            path_distance_calculator
            path_sampler
            path_smoother
            perception_online_evaluator
            perception_utils
            pid_longitudinal_controller
            planning_evaluator
            planning_test_utils
            planning_topic_converter
            planning_validator
            polar_grid
            pose2twist
            pose_estimator_arbiter
            pose_initializer
            pose_instability_detector
            predicted_path_checker
            probabilistic_occupancy_grid_map
            pure_pursuit
            qp_interface
            radar_crossing_objects_noise_filter
            radar_fusion_to_detected_object
            radar_object_clustering
            radar_object_tracker
            radar_scan_to_pointcloud2
            radar_static_pointcloud_filter
            radar_threshold_filter
            radar_tracks_msgs_converter
            radar_tracks_noise_filter
            raw_vehicle_cmd_converter
            route_handler
            rtc_interface
            rtc_manager_rviz_plugin
            rtc_replayer
            sampler_common
            scenario_selector
            shape_estimation
            shift_decider
            signal_processing
            simple_object_merger
            simple_planning_simulator
            static_centerline_optimizer
            steer_offset_estimator
            stop_filter
            surround_obstacle_checker
            system_error_monitor
            system_monitor
            tensorrt_classifier
            tensorrt_common
            tensorrt_yolox
            tier4_adapi_rviz_plugin
            tier4_api_utils
            tier4_automatic_goal_rviz_plugin
            tier4_autoware_api_launch
            tier4_calibration_rviz_plugin
            tier4_camera_view_rviz_plugin
            tier4_control_launch
            tier4_control_rviz_plugin
            tier4_datetime_rviz_plugin
            tier4_debug_rviz_plugin
            tier4_localization_launch
            tier4_localization_rviz_plugin
            tier4_logging_level_configure_rviz_plugin
            tier4_map_launch
            tier4_metrics_rviz_plugin
            tier4_perception_launch
            tier4_perception_rviz_plugin
            tier4_planning_launch
            tier4_planning_rviz_plugin
            tier4_screen_capture_rviz_plugin
            tier4_sensing_launch
            tier4_simulated_clock_rviz_plugin
            tier4_simulator_launch
            tier4_state_rviz_plugin
            tier4_system_launch
            tier4_system_rviz_plugin
            tier4_target_object_type_rviz_plugin
            tier4_traffic_light_rviz_plugin
            tier4_vehicle_launch
            tier4_vehicle_rviz_plugin
            time_utils
            topic_state_monitor
            tracking_object_merger
            traffic_light_arbiter
            traffic_light_classifier
            traffic_light_fine_detector
            traffic_light_map_based_detector
            traffic_light_multi_camera_fusion
            traffic_light_occlusion_predictor
            traffic_light_recognition_marker_publisher
            traffic_light_utils
            traffic_light_visualization
            trajectory_follower_base
            trajectory_follower_node
            tree_structured_parzen_estimator
            tvm_utility
            twist2accel
            vehicle_cmd_gate
            vehicle_velocity_converter
            velodyne_monitor
            yabloc_common
            yabloc_image_processing
            yabloc_monitor
            yabloc_particle_filter
            yabloc_pose_initializer
