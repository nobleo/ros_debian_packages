name: builder

on:
  workflow_dispatch:
  push:

jobs:
  jazzy:
    runs-on: ubuntu-24.04
    steps:
      - uses: jspricke/ros-deb-builder-action@main
        with:
          ROS_DISTRO: jazzy
          DEB_DISTRO: noble
          ROSDEP_SOURCE: "yaml https://github.com/nobleo/ros_debian_packages/raw/main/rosdep/source.yaml"
          # GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} only on main branch
          GITHUB_TOKEN: "${{ github.ref == 'refs/heads/main' && secrets.GITHUB_TOKEN || '' }}"
          REPOS_FILE: jazzy.repos
          GIT_LFS: true
          SBUILD_CONF: '$enable_network = 1;'  # For rmw_zenoh and novatel
          # List generated by:
          # vcs import --input jazzy.repos
          # echo -e "$(colcon list --names-only)\n$(colcon list --names-only --packages-up-to \
          #   autoware_detected_object_feature_remover \
          #   autoware_detection_by_tracker \
          #   autoware_euclidean_cluster \
          #   autoware_ground_segmentation \
          #   autoware_object_merger \
          #   autoware_obstacle_stop_planner \
          #   autoware_pointcloud_preprocessor \
          #   autoware_shape_estimation \
          #   autoware_perception_rviz_plugin \
          #   )" | sort | uniq -u
          SKIP_PACKAGES: >-
            ad_api_adaptors
            ad_api_visualizers
            automatic_pose_initializer
            autoware_accel_brake_map_calibrator
            autoware_ad_api_specs
            autoware_ar_tag_based_localizer
            autoware_auto_common
            autoware_autonomous_emergency_braking
            autoware_behavior_path_avoidance_by_lane_change_module
            autoware_behavior_path_dynamic_obstacle_avoidance_module
            autoware_behavior_path_external_request_lane_change_module
            autoware_behavior_path_goal_planner_module
            autoware_behavior_path_lane_change_module
            autoware_behavior_path_planner
            autoware_behavior_path_planner_common
            autoware_behavior_path_sampling_planner_module
            autoware_behavior_path_side_shift_module
            autoware_behavior_path_start_planner_module
            autoware_behavior_path_static_obstacle_avoidance_module
            autoware_behavior_velocity_blind_spot_module
            autoware_behavior_velocity_crosswalk_module
            autoware_behavior_velocity_detection_area_module
            autoware_behavior_velocity_intersection_module
            autoware_behavior_velocity_no_drivable_lane_module
            autoware_behavior_velocity_no_stopping_area_module
            autoware_behavior_velocity_occlusion_spot_module
            autoware_behavior_velocity_planner
            autoware_behavior_velocity_planner_common
            autoware_behavior_velocity_run_out_module
            autoware_behavior_velocity_speed_bump_module
            autoware_behavior_velocity_stop_line_module
            autoware_behavior_velocity_template_module
            autoware_behavior_velocity_traffic_light_module
            autoware_behavior_velocity_virtual_traffic_light_module
            autoware_behavior_velocity_walkway_module
            autoware_bezier_sampler
            autoware_bytetrack
            autoware_carla_interface
            autoware_cluster_merger
            autoware_collision_detector
            autoware_compare_map_segmentation
            autoware_component_interface_tools
            autoware_component_monitor
            autoware_control_evaluator
            autoware_control_validator
            autoware_costmap_generator
            autoware_crosswalk_traffic_light_estimator
            autoware_default_adapi
            autoware_detected_object_validation
            autoware_ekf_localizer
            autoware_elevation_map_loader
            autoware_evaluator_utils
            autoware_external_cmd_converter
            autoware_external_cmd_selector
            autoware_external_velocity_limit_selector
            autoware_freespace_planner
            autoware_freespace_planning_algorithms
            autoware_frenet_planner
            autoware_geo_pose_projector
            autoware_geography_utils
            autoware_gnss_poser
            autoware_goal_distance_calculator
            autoware_grid_map_utils
            autoware_gyro_odometer
            autoware_image_diagnostics
            autoware_image_projection_based_fusion
            autoware_image_transport_decompressor
            autoware_imu_corrector
            autoware_joy_controller
            autoware_kalman_filter
            autoware_landmark_manager
            autoware_lane_departure_checker
            autoware_lidar_apollo_instance_segmentation
            autoware_lidar_centerpoint
            autoware_lidar_marker_localizer
            autoware_lidar_transfusion
            autoware_livox_tag_filter
            autoware_localization_error_monitor
            autoware_localization_util
            autoware_map_based_prediction
            autoware_map_height_fitter
            autoware_map_projection_loader
            autoware_map_tf_generator
            autoware_mission_details_overlay_rviz_plugin
            autoware_mission_planner
            autoware_motion_velocity_dynamic_obstacle_stop_module
            autoware_motion_velocity_obstacle_velocity_limiter_module
            autoware_motion_velocity_out_of_lane_module
            autoware_motion_velocity_planner_common
            autoware_motion_velocity_planner_node
            autoware_mpc_lateral_controller
            autoware_multi_object_tracker
            autoware_ndt_scan_matcher
            autoware_object_range_splitter
            autoware_object_velocity_splitter
            autoware_objects_of_interest_marker_interface
            autoware_obstacle_collision_checker
            autoware_obstacle_cruise_planner
            autoware_occupancy_grid_map_outlier_filter
            autoware_operation_mode_transition_manager
            autoware_osqp_interface
            autoware_overlay_rviz_plugin
            autoware_path_distance_calculator
            autoware_path_optimizer
            autoware_path_sampler
            autoware_path_smoother
            autoware_pid_longitudinal_controller
            autoware_planning_evaluator
            autoware_planning_topic_converter
            autoware_planning_validator
            autoware_polar_grid
            autoware_pose2twist
            autoware_pose_covariance_modifier
            autoware_pose_estimator_arbiter
            autoware_pose_initializer
            autoware_pose_instability_detector
            autoware_probabilistic_occupancy_grid_map
            autoware_processing_time_checker
            autoware_pure_pursuit
            autoware_radar_crossing_objects_noise_filter
            autoware_radar_fusion_to_detected_object
            autoware_radar_object_clustering
            autoware_radar_object_tracker
            autoware_radar_scan_to_pointcloud2
            autoware_radar_static_pointcloud_filter
            autoware_radar_threshold_filter
            autoware_radar_tracks_msgs_converter
            autoware_radar_tracks_noise_filter
            autoware_raindrop_cluster_filter
            autoware_raw_vehicle_cmd_converter
            autoware_remaining_distance_time_calculator
            autoware_rtc_interface
            autoware_sampler_common
            autoware_scenario_selector
            autoware_shift_decider
            autoware_simple_object_merger
            autoware_smart_mpc_trajectory_follower
            autoware_static_centerline_generator
            autoware_steer_offset_estimator
            autoware_stop_filter
            autoware_surround_obstacle_checker
            autoware_tensorrt_classifier
            autoware_tensorrt_yolox
            autoware_testing
            autoware_time_utils
            autoware_tracking_object_merger
            autoware_traffic_light_arbiter
            autoware_traffic_light_classifier
            autoware_traffic_light_fine_detector
            autoware_traffic_light_map_based_detector
            autoware_traffic_light_multi_camera_fusion
            autoware_traffic_light_occlusion_predictor
            autoware_traffic_light_visualization
            autoware_trajectory_follower_base
            autoware_trajectory_follower_node
            autoware_twist2accel
            autoware_vehicle_cmd_gate
            autoware_velocity_smoother
            bag_time_manager_rviz_plugin
            bluetooth_monitor
            component_state_monitor
            control_performance_analysis
            diagnostic_converter
            diagnostic_graph_aggregator
            diagnostic_graph_utils
            dummy_diag_publisher
            dummy_infrastructure
            dummy_perception_publisher
            duplicated_node_checker
            fake_test_node
            fault_injection
            global_parameter_loader
            glog_component
            hazard_status_converter
            kinematic_evaluator
            learning_based_vehicle_model
            localization_evaluator
            map_loader
            mrm_comfortable_stop_operator
            mrm_emergency_stop_operator
            mrm_handler
            perception_online_evaluator
            perception_utils
            predicted_path_checker
            qp_interface
            reaction_analyzer
            simple_planning_simulator
            system_diagnostic_monitor
            system_monitor
            tier4_adapi_rviz_plugin
            tier4_api_utils
            tier4_autoware_api_launch
            tier4_camera_view_rviz_plugin
            tier4_control_launch
            tier4_datetime_rviz_plugin
            tier4_dummy_object_rviz_plugin
            tier4_localization_launch
            tier4_localization_rviz_plugin
            tier4_map_launch
            tier4_perception_launch
            tier4_planning_launch
            tier4_planning_rviz_plugin
            tier4_sensing_launch
            tier4_simulator_launch
            tier4_state_rviz_plugin
            tier4_system_launch
            tier4_system_rviz_plugin
            tier4_traffic_light_rviz_plugin
            tier4_vehicle_launch
            tier4_vehicle_rviz_plugin
            topic_state_monitor
            traffic_light_recognition_marker_publisher
            traffic_light_utils
            tvm_utility
            vehicle_door_simulator
            vehicle_velocity_converter
            velodyne_monitor
            yabloc_common
            yabloc_image_processing
            yabloc_monitor
            yabloc_particle_filter
            yabloc_pose_initializer

  rolling:
    runs-on: ubuntu-24.04
    steps:
      - uses: jspricke/ros-deb-builder-action@main
        with:
          ROS_DISTRO: rolling
          DEB_DISTRO: noble
          ROSDEP_SOURCE: "yaml https://github.com/nobleo/ros_debian_packages/raw/main/rosdep/source.yaml"
          # GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} only on main branch
          GITHUB_TOKEN: "${{ github.ref == 'refs/heads/main' && secrets.GITHUB_TOKEN || '' }}"
          REPOS_FILE: rolling.repos
          GIT_LFS: true
          SBUILD_CONF: '$enable_network = 1;'  # For rmw_zenoh and novatel
