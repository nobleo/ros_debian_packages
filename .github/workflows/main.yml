name: builder

on:
  workflow_dispatch:
  push:

jobs:
  iron:
    runs-on: ubuntu-24.04
    steps:
      - uses: jspricke/ros-deb-builder-action@main
        with:
          ROS_DISTRO: iron
          DEB_DISTRO: jammy
          # GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} only on main branch
          GITHUB_TOKEN: "${{ github.ref == 'refs/heads/main' && secrets.GITHUB_TOKEN || '' }}"
          REPOS_FILE: iron.repos
          GIT_LFS: true
          SBUILD_CONF: '$enable_network = 1;'  # For rmw_zenoh and novatel
          # List generated by:
          # vcs import --input iron.repos
          # echo -e "$(colcon list --names-only)\n$(colcon list --names-only --packages-up-to autoware_ground_segmentation)" | sort | uniq -u
          SKIP_PACKAGES: >-
            ad_api_adaptors
            ad_api_visualizers
            automatic_pose_initializer
            autoware_accel_brake_map_calibrator
            autoware_ad_api_specs
            autoware_adapi_v1_msgs
            autoware_adapi_version_msgs
            autoware_ar_tag_based_localizer
            autoware_auto_common
            autoware_autonomous_emergency_braking
            autoware_behavior_path_avoidance_by_lane_change_module
            autoware_behavior_path_dynamic_obstacle_avoidance_module
            autoware_behavior_path_external_request_lane_change_module
            autoware_behavior_path_goal_planner_module
            autoware_behavior_path_lane_change_module
            autoware_behavior_path_planner
            autoware_behavior_path_planner_common
            autoware_behavior_path_sampling_planner_module
            autoware_behavior_path_side_shift_module
            autoware_behavior_path_start_planner_module
            autoware_behavior_path_static_obstacle_avoidance_module
            autoware_behavior_velocity_blind_spot_module
            autoware_behavior_velocity_crosswalk_module
            autoware_behavior_velocity_detection_area_module
            autoware_behavior_velocity_intersection_module
            autoware_behavior_velocity_no_drivable_lane_module
            autoware_behavior_velocity_no_stopping_area_module
            autoware_behavior_velocity_occlusion_spot_module
            autoware_behavior_velocity_planner
            autoware_behavior_velocity_planner_common
            autoware_behavior_velocity_run_out_module
            autoware_behavior_velocity_speed_bump_module
            autoware_behavior_velocity_stop_line_module
            autoware_behavior_velocity_template_module
            autoware_behavior_velocity_traffic_light_module
            autoware_behavior_velocity_virtual_traffic_light_module
            autoware_behavior_velocity_walkway_module
            autoware_bezier_sampler
            autoware_control_evaluator
            autoware_control_msgs
            autoware_control_validator
            autoware_costmap_generator
            autoware_crosswalk_traffic_light_estimator
            autoware_external_cmd_converter
            autoware_external_cmd_selector
            autoware_external_velocity_limit_selector
            autoware_freespace_planner
            autoware_freespace_planning_algorithms
            autoware_frenet_planner
            autoware_grid_map_utils
            autoware_joy_controller
            autoware_landmark_manager
            autoware_lane_departure_checker
            autoware_lanelet2_extension_python
            autoware_livox_tag_filter
            autoware_localization_msgs
            autoware_map_based_prediction
            autoware_mission_details_overlay_rviz_plugin
            autoware_mission_planner
            autoware_motion_utils
            autoware_motion_velocity_dynamic_obstacle_stop_module
            autoware_motion_velocity_obstacle_velocity_limiter_module
            autoware_motion_velocity_out_of_lane_module
            autoware_motion_velocity_planner_common
            autoware_motion_velocity_planner_node
            autoware_mpc_lateral_controller
            autoware_objects_of_interest_marker_interface
            autoware_obstacle_cruise_planner
            autoware_obstacle_stop_planner
            autoware_operation_mode_transition_manager
            autoware_overlay_rviz_plugin
            autoware_path_optimizer
            autoware_path_sampler
            autoware_path_smoother
            autoware_perception_rviz_plugin
            autoware_pid_longitudinal_controller
            autoware_planning_evaluator
            autoware_planning_test_manager
            autoware_planning_topic_converter
            autoware_planning_validator
            autoware_pose_covariance_modifier
            autoware_pure_pursuit
            autoware_raw_vehicle_cmd_converter
            autoware_remaining_distance_time_calculator
            autoware_route_handler
            autoware_rtc_interface
            autoware_sampler_common
            autoware_scenario_selector
            autoware_sensing_msgs
            autoware_shift_decider
            autoware_smart_mpc_trajectory_follower
            autoware_static_centerline_generator
            autoware_steer_offset_estimator
            autoware_stop_filter
            autoware_surround_obstacle_checker
            autoware_system_msgs
            autoware_test_utils
            autoware_testing
            autoware_trajectory_follower_base
            autoware_trajectory_follower_node
            autoware_v2x_msgs
            autoware_vehicle_cmd_gate
            autoware_velocity_smoother
            bag_time_manager_rviz_plugin
            bluetooth_monitor
            bytetrack
            cluster_merger
            compare_map_segmentation
            component_interface_specs
            component_interface_tools
            component_interface_utils
            component_state_monitor
            control_performance_analysis
            cuda_utils
            default_ad_api
            detected_object_feature_remover
            detected_object_validation
            detection_by_tracker
            diagnostic_converter
            diagnostic_graph_aggregator
            diagnostic_graph_utils
            dummy_diag_publisher
            dummy_infrastructure
            dummy_perception_publisher
            duplicated_node_checker
            ekf_localizer
            elevation_map_loader
            emergency_handler
            euclidean_cluster
            fake_test_node
            fault_injection
            geo_pose_projector
            geography_utils
            global_parameter_loader
            glog_component
            gnss_poser
            goal_distance_calculator
            gyro_odometer
            hazard_status_converter
            image_diagnostics
            image_projection_based_fusion
            image_transport_decompressor
            imu_corrector
            interpolation
            kalman_filter
            kinematic_evaluator
            lanelet2_map_preprocessor
            learning_based_vehicle_model
            lidar_apollo_instance_segmentation
            lidar_apollo_segmentation_tvm
            lidar_apollo_segmentation_tvm_nodes
            lidar_centerpoint
            lidar_transfusion
            localization_error_monitor
            localization_evaluator
            localization_util
            map_height_fitter
            map_loader
            map_projection_loader
            map_tf_generator
            mrm_comfortable_stop_operator
            mrm_emergency_stop_operator
            mrm_handler
            multi_object_tracker
            ndt_scan_matcher
            object_merger
            object_range_splitter
            object_recognition_utils
            object_velocity_splitter
            obstacle_collision_checker
            occupancy_grid_map_outlier_filter
            osqp_interface
            path_distance_calculator
            perception_online_evaluator
            perception_utils
            polar_grid
            pose2twist
            pose_estimator_arbiter
            pose_initializer
            pose_instability_detector
            predicted_path_checker
            probabilistic_occupancy_grid_map
            qp_interface
            radar_crossing_objects_noise_filter
            radar_fusion_to_detected_object
            radar_object_clustering
            radar_object_tracker
            radar_scan_to_pointcloud2
            radar_static_pointcloud_filter
            radar_threshold_filter
            radar_tracks_msgs_converter
            radar_tracks_noise_filter
            raindrop_cluster_filter
            reaction_analyzer
            shape_estimation
            signal_processing
            simple_object_merger
            simple_planning_simulator
            system_diagnostic_monitor
            system_error_monitor
            system_monitor
            tensorrt_classifier
            tensorrt_common
            tensorrt_yolox
            tier4_adapi_rviz_plugin
            tier4_api_msgs
            tier4_api_utils
            tier4_auto_msgs_converter
            tier4_autoware_api_launch
            tier4_camera_view_rviz_plugin
            tier4_control_launch
            tier4_control_msgs
            tier4_datetime_rviz_plugin
            tier4_external_api_msgs
            tier4_hmi_msgs
            tier4_localization_launch
            tier4_localization_msgs
            tier4_localization_rviz_plugin
            tier4_map_launch
            tier4_map_msgs
            tier4_perception_launch
            tier4_perception_msgs
            tier4_perception_rviz_plugin
            tier4_planning_launch
            tier4_planning_rviz_plugin
            tier4_rtc_msgs
            tier4_sensing_launch
            tier4_simulation_msgs
            tier4_simulator_launch
            tier4_state_rviz_plugin
            tier4_system_launch
            tier4_system_msgs
            tier4_system_rviz_plugin
            tier4_traffic_light_rviz_plugin
            tier4_v2x_msgs
            tier4_vehicle_launch
            tier4_vehicle_msgs
            tier4_vehicle_rviz_plugin
            time_utils
            topic_state_monitor
            tracking_object_merger
            traffic_light_arbiter
            traffic_light_classifier
            traffic_light_fine_detector
            traffic_light_map_based_detector
            traffic_light_multi_camera_fusion
            traffic_light_occlusion_predictor
            traffic_light_recognition_marker_publisher
            traffic_light_utils
            traffic_light_visualization
            tvm_utility
            twist2accel
            vehicle_door_simulator
            vehicle_velocity_converter
            velodyne_monitor
            yabloc_common
            yabloc_image_processing
            yabloc_monitor
            yabloc_particle_filter
            yabloc_pose_initializer

  jazzy:
    runs-on: ubuntu-24.04
    steps:
      - uses: jspricke/ros-deb-builder-action@main
        with:
          ROS_DISTRO: jazzy
          DEB_DISTRO: noble
          # GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} only on main branch
          GITHUB_TOKEN: "${{ github.ref == 'refs/heads/main' && secrets.GITHUB_TOKEN || '' }}"
          REPOS_FILE: jazzy.repos
          GIT_LFS: true
          SBUILD_CONF: '$enable_network = 1;'  # For rmw_zenoh and novatel
